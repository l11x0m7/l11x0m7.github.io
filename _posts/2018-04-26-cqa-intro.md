---
layout: post
title: 社区问答之QA匹配问题探索
date: 2018-04-26
categories: blog
tags: [深度学习, 问答, QA, Question Answering]
description: 阐述社区问答中QA匹配模型与实现
---


# 社区问答之QA匹配问题探索

## 问题描述

在网络社区中或一些检索任务中，给出一个问题q，如何找到与这个问题q最接近的答案a。在检索任务中，learning to ranking的方式一般可以分为如下三种：

* pointwise：对每个$(Q,d_i)$对，输出得分。在只有两种状态的情况下，则是输出标签0或1，1代表相关，0代表无关
* pairwise：对每个$(Q,d_i,d_j)$对，对$d_i$与$d_j$进行排序，判断其中哪个更贴近问题Q。在只有两种状态的情况下，则是每次输入$(Q,d_i,d_j)$，其中$d_i$与Q相关，$d_j$与Q无关
* listwise：对所有文档D关于问题Q进行排序。在只有两种状态的情况下，也是希望将标签为1的排在前面，或者如果文档数固定，可以看出是一个n分类问题（多标签，因为可能会有多个相关文档）


## 数据介绍

此处我们尝试在WikiQA上进行实践。其余数据集如TrecQA或者InsuranceQA也是一样的。

WikiQA数据集中，我们使用"tsv"格式的文件，该文件内部包含7个：QuestionID、Question、DocumentID、DocumentTitle、SentenceID、Sentence、Label。构建数据时，我们只考虑问题与答案，不考虑标题。并且在测试的时候，我们需要去掉不包含标签为1的答案的问题（问题对应的答案标签全为0的需要去掉）。


## 评测指标

### MRR（mean reciprocal rank）

这个指标只考虑与当前问题相关的所有答案中，rank最靠前的那个答案，数据集的MRR就是每个样本的该答案排序的倒数的和的均值。一般用于问题与答案是否匹配的二状态问题中。假设对于问题$q_1$答案排序为$a_1,a_2,a_3$，与问题$q_1$相关的答案为$a_3$；对于与问题$q_2$答案排序为$a_4,a_5,a_6,a_7$，与问题$q_2$相关的答案为$a_5$和$a_6$，那么$MRR=(1/3+1/2)/2=5/12$。MRR公式可以简单描述为：

$$
MRR=\frac{\sum_{i=1}^{n}{1/first\ match\ answer\ rank}}{n}
$$


### MAP(mean average precision)

MAP也是衡量问题与答案是否匹配（二状态）的一个指标。与MRR不同的是，MAP考虑所有与问题相关的答案的排序。假设$q_1$对应相关的答案排名是1，3，6（共三个答案与问题$q_1$相关，其余答案不相关），那么对于$q_1$，可以算出它的average precision为$ap_1=(1/1+2/3+3/6)/3$；对于$q_2$，与之相关的答案排名是2，5，7，8（共五个答案与$q_2$相关，有一个没有被召回），那么对于$q_2$，$ap_2=(1/2+2/5+3/7+4/8+0)/5$，那么这个排序算法的MAP就是$MAP=(ap1+ap2)/2$，具体公式可以写成如下：

$$
AP_j=average(\sum{frac{order}{rank}})\\
MAP=\sum_j{AP_j}
$$

### NDCG(Normalized Discounted Cumulative Gain)

NDCG指标可以用于不同打分的答案，也就是不局限于二状态的情况。一个问题和不同答案的相关度可以用不同分数来表示。NDCG其实可以由DCG和iDCG得到。iDCG表示最理想排序情况下的DCG分数。假设我们只考虑n个文档排序中的前K个文档，那么：

$$
DCG@K=\sum_{i=1}^{p}\frac{2^{rel_i}-1}{log_2(i+1)} \\
iDCG@K=\sum_{i=1}^{REL}\frac{2^{rel_i}-1}{log_2(i+1)} \\
NDCG@K=\frac{DCG_K}{iDCG_K}
$$

其中，$rel_i$表示当前排序$i$的文档与问题的相关度，$REL$表示按照相关度排序的列表。假设对于一个问题Q，得到排序文档$D_1,D_2,D_3$，而每个文档与Q的相关度分别为3，4，2。那么我们可以计算：

$$
DCG=\frac{2^3-1}{log_2(2)}+\frac{2^4-1}{log_2(3)}+\frac{2^2-1}{log2(4)} \\
iDCG=\frac{2^4-1}{log_2(2)}+\frac{2^3-1}{log_2(3)}+\frac{2^2-1}{log2(4)} \\
NDCG=\frac{DCG}{iDCG}
$$

## 模型实现

### Siamese-NN模型

### Siamese-CNN模型

### Siamese-RNN模型

### pairwise QACNN模型


## 实验效果

## References
